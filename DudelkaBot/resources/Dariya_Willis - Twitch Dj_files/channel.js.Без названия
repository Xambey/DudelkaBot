var iarray=new Object();iarray.page_current='playlist_c';$(function(){$(".button").button();$('.circle').tooltipster({animation:'grow',delay:200,position:'bottom'});$('.m_tool').tooltipster({animation:'swing',delay:200,position:'left'});if(iarray.bg_img){var img=new Image();img.onload=function(){$('.main').css("box-shadow","none");$('body').css("background","transparent url("+iarray.bg_img+") no-repeat fixed center center / cover");};img.src=iarray.bg_img;}
if(Cookies.get('author_dj')){$("#author").val(Cookies.get('author_dj'));}
var url_hash=window.location.hash;if(url_hash!=''){switch_menu(url_hash.replace('#',''));}});function load_twitch(login){$.getScript("https://api.twitch.tv/kraken/streams/?channel="+login+"&callback=twitch_info&client_id=58apdkh91ows8rrfnph8ld96d7lqsrc");$.getScript("https://api.twitch.tv/kraken/channels/"+login+"?callback=twitch_info_o&client_id=58apdkh91ows8rrfnph8ld96d7lqsrc");}
function twitch_info(json){try{if(json._total!=0){$("#c_viewers").text(json.streams[0].viewers);$("#status").text("LIVE");$("#status").attr("class","green_t");$("#c_viewers").show();}else{$("#status").text("OFFLINE");$("#status").attr("class","red_t");$("#c_viewers").hide();}}catch(e){console.log(e.message)}}
function twitch_info_o(json){if(json.logo){$("#avatar").attr('src',json.logo);Cookies.set(json.display_name.toLowerCase(),json.logo,{expires:30,path:''});}
$("#c_name").text(json.display_name);}
function d_error(text){$("#error").text(text);$("#error").finish().stop(true,true).show('pulsate',500).delay(5000).fadeOut(500);}
function switch_panel(page){if(page==iarray.page_current&&page=='top'){$("#pages").children().hide();$(".top_button").show();$("."+iarray.page_previous).stop(true,true).fadeIn(300);iarray.page_current=iarray.page_previous;}else{$("#pages").children().hide();$(".top_button").show();$("."+page).stop(true,true).fadeIn(300);iarray.page_previous=iarray.page_current;iarray.page_current=page;}}
function switch_menu(page){$("#plus").hide();$("#minus").hide();switch(page){case'plus':switch_panel("add");break;case'minus':switch_panel("playlist_c");break;}
$("#"+page).stop(true,true).fadeIn(300);}
function playlist(id){iarray.playlist="";$.getJSON("/includes/back.php?func=playlist&channel="+id+"&c",function(data){if(data){$.each(data,function(key,value){if(value['status']==1){iarray.playlist+="<table class='playlist_item_c tooltipster-light tooltipstered' title='Сейчас играет этот трек'><tr><th rowspan='2'><img src='https://i.ytimg.com/vi/"+value['yid']+"/default.jpg' style='width: 57px;height: 47px;'></th><th class='item_title_c'><a href='https://www.youtube.com/watch?v="+value['yid']+"' target='_blank'>"+value['title']+"</a></th><th rowspan='2'><img src='/template/img/play_c.png' style='vertical-align: middle;'></th></tr><tr><td class='item_author'>Прислал: "+value['author']+"</td></tr></table>";}else{iarray.playlist+="<table class='playlist_item'><tr><th rowspan='2'><img src='https://i.ytimg.com/vi/"+value['yid']+"/default.jpg' style='width: 57px;height: 47px;'></th><th class='item_title'><a href='https://www.youtube.com/watch?v="+value['yid']+"' target='_blank'>"+value['title']+"</a></th></tr><tr><td class='item_author'>Прислал: "+value['author']+"</td></tr></table>";}});}else{iarray.playlist="<div class='null_add'>Плейлист пуст, вы можете добавить свой трек<br><button class='button' onclick='switch_menu(\"plus\")'>Добавить</button></div>";}
$(".playlist_c").html(iarray.playlist);$('.playlist_item_c').tooltipster({animation:'grow',delay:200,position:'top'});$(".button").button();});}
function load_top(id){iarray.top="";$.getJSON("/includes/back.php?func=channel_top&channel="+id,function(data){if(data){$.each(data,function(key,value){$("#top_"+key).text(value['author']);$("#top_"+key).attr('title',value['author']);});}else{$(".top").html("<table class='top_null'><tr><td colspan='2'>В этом месяце, нет заказавших.</td></tr></table>");}});}
function add_track(id){if($("#url").val()&&$("#author").val()){Cookies.set('author_dj',$("#author").val(),{expires:365,path:''});$("#add_track_b").button({disabled:true});$.post("/includes/back.php?func=add_track&channel="+id,{url:$("#url").val(),author:$("#author").val()},function(data){var info=JSON.parse(data);if(info.pay){iarray.robokassa_url=info.robokassa_url;iarray.freekassa_url=info.freekassa_url;iarray.unitpay_url=info.unitpay_url;iarray.unitpay_url3=info.unitpay_url3;$("#wm_form").html(info.webmoney_form);switch_panel('pay');}else{if(info.success==1){playlist(id);switch_menu("minus");$("#add_track_b").button({disabled:false});}else{d_error(info.error);$("#add_track_b").button({disabled:false});}}
$("#url").val("");}).fail(function(xhr){location.reload();});}else{d_error("Заполните все поля!");}}
function pay(method,system,type){switch(method){case'webmoney':if(system==4){$('<input>').attr({type:'hidden',name:'LMI_ALLOW_SDP',value:4}).appendTo('#pay_wm');}
$("#pay_wm").submit();break;case'robokassa':if(system){window.location=iarray.robokassa_url+"&IncCurrLabel="+system;}else{window.location=iarray.robokassa_url;}
break;case'freekassa':if(system){window.location=iarray.freekassa_url+"&i="+system;}else{window.location=iarray.freekassa_url;}
break;case'unitpay':if(system){if(type){window.location="https://unitpay.ru/pay/23946-e23be/"+system+iarray.unitpay_url3+"&hideMenu=true&hideOtherMethods=true";}else{window.location="https://unitpay.ru/pay/23946-e23be/"+system+iarray.unitpay_url3;}}else{window.location=iarray.unitpay_url;}
break;}}
function twitch_auth(){window.open("/kraken","Авторизация Twitch.tv","width=500,height=550");$("#auth_twitch_b").button("disable");setInterval('token_check()',1000);}
function token_check(){if(Cookies.get('auth_token')){location.reload();}}
function kraken_cleanup(){Cookies.remove('PHPSESSID',{path:'/'});location.reload();}
function load_youtube(name){iarray.yt_channel_name=name;$.getScript("https://www.googleapis.com/youtube/v3/channels?part=snippet&forUsername="+name+"&key=AIzaSyCDvybE7v6tOI-DXkylCPvIlajijnTZrDE&callback=load_youtube_id");}
function load_youtube_id(data){if(data.pageInfo.totalResults!=0){$.getScript("https://www.googleapis.com/youtube/v3/search?part=snippet&channelId="+data.items[0].id+"&eventType=live&type=video&key=AIzaSyCDvybE7v6tOI-DXkylCPvIlajijnTZrDE&callback=load_youtube_data");if(data.items[0].snippet.thumbnails.medium){$("#avatar").attr('src',data.items[0].snippet.thumbnails.medium.url);Cookies.set(iarray.yt_channel_name.toLowerCase(),data.items[0].snippet.thumbnails.medium.url,{expires:30,path:''});}}else{$("#status").text("OFFLINE");$("#status").attr("class","red_t");$("#c_viewers").hide();}}
function load_youtube_data(data){if(data.items[0]!=undefined){$.getScript("https://www.googleapis.com/youtube/v3/videos?id="+data.items[0].id.videoId+"&key=AIzaSyCDvybE7v6tOI-DXkylCPvIlajijnTZrDE&part=snippet,liveStreamingDetails&callback=load_youtube_stream");}else{$("#status").text("OFFLINE");$("#status").attr("class","red_t");$("#c_viewers").hide();}}
function load_youtube_stream(data){$("#c_viewers").text(data.items[0].liveStreamingDetails.concurrentViewers);$("#status").text("LIVE");$("#status").attr("class","green_t");$("#c_viewers").show();}
(function(d,w,c){(w[c]=w[c]||[]).push(function(){try{w.yaCounter33468825=new Ya.Metrika({id:33468825,clickmap:true,trackLinks:true,accurateTrackBounce:true});}catch(e){}});var n=d.getElementsByTagName("script")[0],s=d.createElement("script"),f=function(){n.parentNode.insertBefore(s,n);};s.type="text/javascript";s.async=true;s.src="https://mc.yandex.ru/metrika/watch.js";if(w.opera=="[object Opera]"){d.addEventListener("DOMContentLoaded",f,false);}else{f();}})(document,window,"yandex_metrika_callbacks");